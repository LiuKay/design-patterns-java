### 如何利用面向对象分析和设计编写一个鉴权功能



#### 需求描述

- 调用方进行接口请求的时候，将 URL、AppID、密码、时间戳拼接在一起，通过加密算法生成 token，并且将 token、AppID、时间戳拼接在 URL 中，一并发送到微服务端。
- 微服务端在接收到调用方的接口请求之后，从请求中拆解出 token、AppID、时间戳
- 微服务端首先检查传递过来的时间戳跟当前时间，是否在 token 失效时间窗口内。如果已经超过失效时间，那就算接口调用鉴权失败，拒绝接口调用请求
- 如果 token 验证没有过期失效，微服务端再从自己的存储中，取出 AppID 对应的密码，通过同样的 token 生成算法，生成另外一个 token，与调用方传递过来的 token 进行匹配。如果一致，则鉴权成功，允许接口调用；否则就拒绝接口调用

#### 如何做面向对象分析

- 划分职责进而识别出有哪些类（职责以拆分的功能点划分，功能点只负责一件很小的事，相关的功能点可归为同一类中）
- 定义类及其属性和方法（将涉及的名词作为属性候选，动词作为方法候选）
- 定义类之间的交互关系（简单来讲，用泛化，实现，依赖，组合即可）
- 将类组装起来并提供对外接口（模块接口，执行入口）

-----

划分功能点得出相关类：

- AuthToken :  生成、匹配 token、判断 token 是否过期
- ApiRequest : 解析请求 URL 封装各个参数
- CredentialStorage :  从存储中根据 AppID 获取密码，存储可为不同的实现，可提供默认实现
- ApiAuthenticator : 对外接口

![auth](https://gitee.com/kaybee/markdown_pics/raw/master/img/auth.png)

